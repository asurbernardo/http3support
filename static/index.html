<!DOCTYPE html>
<html lang="en">
<head>
    <title>HTTP/3 Support</title>
    <meta charset="utf-8">
    <meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1">
    <style type="text/css">
        body {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            font-size: 16pt;
            font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Open Sans,Helvetica Neue;
            line-height:1.5;
            color:#333;
        }
        .hero {
            grid-column: 1 / 3;
            max-width: 768px;
            margin: 2rem 1em 2rem 1em;
        }
        .hero__title {
            font-size: 4rem;
        }
        .hero__subtitle {
            font-size: 2rem;
            margin-top: -2em;
            margin-bottom: 1em;
        }
        .hero__form {
            display: flex;
            width:100%;
            flex-wrap: nowrap;
            align-items: stretch;
            border: 1px solid #ddd;
        }
        .hero__input {
            flex: 1;
            margin: 0;
            border: none;
            padding: 1em;
            font-size: 1.25rem;
        }
        .hero__submit {
            margin: 0;
            border: none;
            padding: 1em;
            cursor: pointer;
            font-size: 1.25rem;
            font-weight: 700;
        }
        .hero__message {
            display: block;
            visibility: hidden;
            margin-top: 1em;
            font-size: 1.25em;
        }
    </style>
</head>
<body>
    <main class="hero">
        <h1 class="hero__title">HTTP3.support</h1>
        <h2 class="hero__subtitle">Test if your web supports HTTP/3</h2>
        <form class="hero__form" action="/check" method="POST" accept-charset="utf-8">
            <input  class="hero__input" type="url" ref="url" name="url" pattern="(https|http)://.*" placeholder="https://example.com" required>
            <input class="hero__submit" type="submit" value="Check!">
        </form>
        <span class="hero__message" id="message">‚è∞ Loading...</span>
        <h2>What is this site?</h2>
        <p>Basically I packaged <b>Cloudflares Quiche HTTP3 client</b>, put a web interface and deployed it to the internet. You can check if your server supports H3 protocol. This is an <b>Open Source</b> project so you can audit the code and contribute if you feel like it. You can check the Github repository <a href="https://github.com/asurbernardo/http3support" aria-label="GitHub repository">here</a>.</p>
        <p>Made by <a href="https://asur.dev">Asur</a> üßê</p>
    </main>

    <script type="text/javascript">
        const messages = {
            "ok": `Your site <b>does</b> support HTTP/3! üëç`,
            "ko": `Your site <b>doesn't</b> support HTTP/3! üëé`,
            "loading": `‚è≥ Loading... ‚è≥`
        };
        document.addEventListener('submit', e => {
            const message = document.getElementById('message');
            message.innerHTML = messages.loading;
            message.style.visibility = 'visible';
            // Manage request
            const form = e.target;
            const headers = new Headers();
            headers.append('Content-Type', 'application/json');
            headers.append('Accept-Encoding', 'gzip, deflate');
            // Post data using the Fetch API
            fetch(form.action, {
                method: form.method,
                headers: headers,
                body: JSON.stringify({"url": form.url.value}),
                cache: 'default'
            })
            .then(response => {
                return response.json();
            })
            .then (response => {
                switch (response.supported) {
                    case true:
                        message.innerHTML = messages.ok;
                        break;
                    case false:
                        message.innerHTML = messages.ko;
                        break;
                }
            })
            .catch(err => {
                console.log(err);
            });
            // Prevent the default form submit
            e.preventDefault();
        });
    </script>
</body>
</html>