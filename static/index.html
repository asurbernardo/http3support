<!DOCTYPE html>
<html lang="en">
<head>
    <title>HTTP/3 Support</title>
    <meta charset="utf-8">
    <meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1">
    <style type="text/css">
        body {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            font-size: 16pt;
            font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Open Sans,Helvetica Neue;
            line-height:1.5;
            color:#333;
        }
        .hero {
            grid-column: 1 / 3;
            max-width: 768px;
            margin: 4rem auto 2rem;
        }
        .hero__title {
            font-size: 4rem;
        }
        .hero__subtitle {
            font-size: 2rem;
            margin-top: -2em;
            margin-bottom: 1em;
        }
        .hero__form {
            display: flex;
            width:100%;
            flex-wrap: nowrap;
            align-items: stretch;
            border: 1px solid #ddd;
        }
        .hero__input {
            flex: 1;
            margin: 0;
            border: none;
            padding: 1em;
            font-size: 1.25rem;
        }
        .hero__submit {
            margin: 0;
            border: none;
            padding: 1em;
            cursor: pointer;
            font-size: 1.25rem;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <main class="hero">
        <h1 class="hero__title">HTTP3.support</h1>
        <h2 class="hero__subtitle">Test if your web supports HTTP/3</h2>
        <form class="hero__form" action="/check" method="POST" accept-charset="utf-8">
            <input  class="hero__input" type="url" ref="url" name="url" pattern="(https|http)://.*" placeholder="https://example.com" required>
            <input class="hero__submit" type="submit" value="Check!">
        </form>
        <span id="loading-message" hidden>Loading...</span>
        <span id="ok-message" hidden>OK</span>
        <span id="ko-message" hidden>KO</span>
        <h2>What is this site?</h2>
        <p>Basically I packaged <b>Cloudflares Quiche HTTP3 client</b>, put a web interface and deployed it to the internet. You can check if your server supports H3 protocol. This is an <b>Open Source</b> project so you can audit the code and contribute if you feel like it. You can check the Github repository <a href="https://github.com/asurbernardo/http3support" aria-label="GitHub repository">here</a>.</p>
    </main>

    <script type="text/javascript">
        document.addEventListener('submit', e => {
            console.log('Loading...');
            loading = document.getElementById('loading-message');
            loading.style.display = 'block';
            // Store reference to form to make later code easier to read
            const form = e.target;
            // Declare headers
            const headers = new Headers();
            headers.append('Content-Type', 'application/json');
            headers.append('Accept-Encoding', 'gzip, deflate');
            // Post data using the Fetch API
            fetch(form.action, {
                method: form.method,
                headers: headers,
                body: JSON.stringify({"url": form.url.value}),
                cache: 'default'
            })
            .then(response => {
                return response.json();
            })
            .catch(err => {
                console.log(err);
            })
            .finally((response) => {
                console.log(response);
                console.log('Not loading anymore...');
                loading.style.display = 'none';
            });
            // Prevent the default form submit
            e.preventDefault();
        });
    </script>
</body>
</html>